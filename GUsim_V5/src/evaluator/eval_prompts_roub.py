import os
import sys
from jinja2 import Template
import json




language = """
请根据以下标准，给出对话回复的语言质量打分，取值为[1,2,3,4,5]:

⭐️ 5 分：语言非常自然、流畅，通俗易懂。  
- 完全符合人类的语言表达习惯。
- 没有任何语法错误、用词不当或逻辑不通顺的问题。
- 推荐内容准确贴合用户需求，菜品名称、食材、风味描述清晰正确。
- 使用者能够毫不费力地理解内容，整体体验非常顺畅和舒适。

⭐️ 4 分：语言大部分自然、流畅，基本通俗易懂。  
- 符合人类语言表达方式，仅有极少数轻微问题（如个别词语略显生硬或句式稍复杂）。
- 没有明显的语法错误或事实性错误（如菜名、口味、食材写错）。
- 整体理解无障碍，推荐内容与用户请求基本一致，使用者感到较为满意。

⭐️ 3 分：语言部分自然，基本能被理解。  
- 存在一些不自然的表达、轻微语法错误或语义模糊之处。
- 虽不影响整体理解，但会影响阅读体验。
- 若出现非关键性的用词错误（例如“意面”误写为“义面”）、地名错误、餐厅名拼写错误、菜品描述偏差等情况，最高只能得 3 分。

⭐️ 2 分：语言明显不自然，部分内容难以理解。  
- 多处存在语法错误、用词不当或结构混乱。
- 部分句子含义不清或逻辑不通。
- 推荐内容与用户请求存在偏离（如用户问中餐，推荐了日料）。
- 使用者需要反复阅读才能理解内容，整体体验较差。

⭐️ 1 分：语言极其不自然，几乎无法理解。  
- 充斥大量语法错误、用词错误或表达混乱。
- 内容严重偏离语境或逻辑断裂。
- 推荐内容完全不符合用户需求或包含严重事实错误（如将“担担面”说成“意大利面”）。
- 使用者几乎无法理解对话内容，严重影响沟通效果。

请注意，该打分为客观打分，和你的用户画像无关，只和回复的语言质量有关。
请注意回复中的语言错误，如果出现了，最高打3分，比如:
请求推荐意面，而回复中推荐了义面。
地名回复错误。 等等
输出要求：
你的分值请使用[naturalness][/naturalness]标签包裹，将int替换为你的打分，请按照以下格式进行回答：
语言质量评价：解释你的打分原因
打分：[naturalness]int[/naturalness]
"""


# recommendation = """
# 请根据以下标准，客观地对推荐系统的推荐内容的满意度打分，该分值为[1,2,3,4,5]:

# 请主要基于你的用户偏好，并结合你的经济情况、健康状况等特异性因素：
# 5 : 推荐的物品非常符合你的所有用户偏好，和你的预期相符甚至超过你原本的预期，让你感到非常满意。
# 4 : 推荐的物品符合你的绝大部分用户偏好，虽然你对推荐物品的少部分特征并不太满意，或者你对该物品的部分属性有一定的疑惑，但整体上来说，推荐的内容让你感到满意。
# 3 : 推荐的物品也许部分符合你的用户偏好，但是该物品的部分特征你并不喜欢，整体来说你觉得这次的推荐差强人意，不能说很好，但也不是很差。
# 2 : 推荐内容和你不喜欢的物品类型接近，或者推荐内容的大部分属性特征你都不感兴趣，只有少部分的特征满足你的要求。从总体上来讲，你对本次的推荐内容不太满意。
# 1 : 推荐内容为你不喜欢的物品，或者推荐内容的所有属性特征都不满足你的预期。从你的用户偏好的角度来讲，你非常不满意本次的推荐内容。或者直接和推荐无关。
# 需要注意的是，你的打分需要符合你的客观特异性因素。比如，你对某些食材过敏，对于该食材相关的推荐内容，你都只会给出最低分1分。对经济情况差的用户，即使推荐内容符合用户偏好，如果价格过高，也会给出较低分数。
# 但是，你的基础打分请不要夹杂主观因素，比如你的心情、所处环境、压力等因素，不应该影响你的基础打分。

# 请注意，该打分为客观打分，仅仅和你的用户偏好、经济情况、健康状况有关，不应该受你的心情、所处环境、压力等主观因素影响。
# 你的分值请使用[recommendation][/recommendation]标签包裹，将int替换为你的打分，请按照以下格式进行回答：
# 评价：解释你的评分原因
# 打分：[recommendation]int[/recommendation]
# """


recommendation = """
请根据以下标准，客观地对推荐系统的推荐内容的满意度打分，该分值为[1,2,3,4,5]:

请主要基于你的用户偏好，并结合你的经济情况、健康状况等特异性因素：
⭐️ 5 分：非常满意
- 推荐内容与你的用户偏好高度匹配。
- 完整回答了你的问题，甚至超出预期。
- 所推荐物品在各方面都符合你的需求，让你感到非常满意。

⭐️ 4 分：满意
- 推荐内容基本符合你的用户偏好。
- 能够较好地回答你的问题，仅存在少量不理想或模糊的部分。
- 整体上令人满意，尽管可能有些小瑕疵或不确定之处。

⭐️ 3 分：一般 / 差强人意
- 推荐内容部分符合你的偏好，但也有明显的不匹配之处。
- 回答了部分问题，但不够全面或深入。
- 总体感觉中等，说不上好，也谈不上差。

⭐️ 2 分：不太满意
- 推荐内容与你的兴趣或需求偏离较大。
- 只有少数特征满足你的要求，无法有效回答你的问题。
- 对推荐结果感到不满意。

⭐️ 1 分：非常不满意 / 无关
- 推荐内容明显不符合你的用户偏好。
- 与你的问题无关，或完全没有回答到你的核心诉求。
- 你会认为这次推荐是失败的或毫无帮助。
需要注意的是，你的打分需要符合你的客观特异性因素。比如，你对某些食材过敏，对于该食材相关的推荐内容，你都只会给出最低分1分。对经济情况差的用户，即使推荐内容符合用户偏好，如果价格过高，也会给出较低分数。
但是，你的基础打分请不要夹杂主观因素，比如你的心情、所处环境、压力等因素，不应该影响你的基础打分。

请注意，该打分为客观打分，仅仅和你的用户偏好、经济情况、健康状况有关，不应该受你的心情、所处环境、压力等主观因素影响。
你的分值请使用[recommendation][/recommendation]标签包裹，将int替换为你的打分，请按照以下格式进行回答：
评价：解释你的评分原因
打分：[recommendation]int[/recommendation]
"""




action = """
请根据以下标准，对于推荐系统对你请求的理解程度和采取的动作策略的好坏进行打分，取值为[1,2,3,4,5]:

你的评分主要基于2个要点：推荐系统是否理解了你的请求，以及推荐系统的回复话术中，采取的动作策略是否准确和恰当：

⭐️ 5 分：完全理解 + 非常恰当  
- 推荐系统**完全理解了用户的请求或意图**；
- 并且采取了**非常准确、恰当的动作策略**来回应；
- 没有任何多余或误导性的行为。

⭐️ 4 分：基本理解 + 较为恰当  
- 推荐系统**大部分理解了用户的请求或意图**；
- 并且采取了**较为恰当的动作策略**；
- 可能存在轻微偏差或略显保守，但整体上是合理的。

⭐️ 3 分：部分理解 + 策略一般  
- 推荐系统**部分理解了用户的请求**；
- 但采取的动作策略**不是最佳选择**，或者有些地方不太合适；
- 回复可能显得机械或不够灵活。

⭐️ 2 分：理解偏差较大 + 策略不当  
- 推荐系统**未能准确理解用户的请求**；
- 并且采取了**明显不合适或无关的动作策略**；
- 导致对话走向偏离预期。

⭐️ 1 分：几乎没有理解 + 完全错误  
- 推荐系统**几乎未理解用户的请求**；
- 并且采取了**完全错误或不相关的动作策略**；
- 导致对话严重脱节或无效。

请注意，你仅仅是对推荐系统的回复中采取的动作策略进行评分，而不是对推荐系统的回复内容进行评分。即，推荐结果的好坏不影响你的评分，你只需要评价推荐系统的回复中采取的动作策略是否准确和恰当。
比如：
1、如果你上一轮的回复是“换一种其它口味的餐厅”，而推荐系统给你推荐了一家口味不一样的餐厅，说明系统很好了地理解了你的回复，并且执行了正确的动作。就算这家餐厅不是你地偏好，你也应该给出5分。
2、如果你上一轮的回复是“换一种其它口味的餐厅”，而推荐系统询问你想要什么口味的餐厅，说明系统很好地理解了你的回复，但是采取的动作策略正确，但不是最佳策略。这种情况下，你应该给出4分。
3、如果你上一轮的回复是“换一种其它口味的餐厅”，而推荐系统给你推荐了一家口味一样的餐厅，说明系统没有理解你的回复，采取的动作策略确实是正确的。这种情况下，你应该给出3分。
4、如果你上一轮的回复是“想问一下这家餐厅的评分如何”，而推荐系统给你重新推荐了一家餐厅，说明系统没有理解你的回复，采取的动作策略也非常不合适。这种情况下，你应该给出1分。

请注意，该打分为客观打分，和你的用户画像无关，和你的个人喜好无关，和你的推荐结果无关，只和推荐系统的回复中采取的动作策略的准确性和恰当性有关。
你的分值请使用[understandability][/understandability]标签包裹，将int替换为你的打分，请按照以下格式进行回答：
评价：解释你的评分原因
打分：[understandability]int[/understandability]
"""

corrector = """
你是一个美食推荐系统领域的专家，同时具备自然语言理解和中文纠错能力。你的任务是对用户输入的语句进行语言层面的纠错与润色。

用户的语句中可能存在以下几类问题：
1. **拼写错误**：如“饺子”误写为“教资”；
2. **语法不通或结构不合理**：如语序混乱、成分残缺等；
3. **用词不准确或不符合语境**：如将“我想吃辣的”说成“我想吃辣乎乎的”；
4. **地名、店名、菜名等专有名词识别错误**：例如“解放西”被误写为“街坊西”。

你需要根据上下文、语言习惯和常识判断可能存在的错误，逐句指出错误所在，并提供修改建议。

请按照以下格式输出：
- 首先，列出你发现的每处错误（一行一句），并说明错误类型；
- 然后，给出修正后的完整语句。

例如：
1.江汉路这边有啥意面店推荐嘛？
2.意面之家可以哇，刚好庆祝下升职嘿嘿！
3.海港城这块有啥湘菜馆子推荐不？风大想就近吃
4.湘鄂情和小湘菜有啥推荐的菜啊？比如有没有教资混沌之类的？同事想试试低盐的
5.湘西大宅门有啥推荐的菜不？同事想吃低盐的，有没有清淡点的啊？

找出的错误：
1. “有啥”属于口语表达，建议改为“有什么”以更正式；  
2. “可以哇”口语化且语气不够正式，建议改为“可以哦”；“庆祝下升职”中“下”用法口语化，建议改为“庆祝升职”；  
3. “这块”口语化，建议改为“这边”或“附近”；“风大想就近吃”语序不通顺，建议改为“风大，想就近吃”；  
4. “教资混沌”拼写错误，应为“饺子馄饨”；“有啥”口语化，建议改为“有什么”；  
5. “有啥”口语化，建议改为“有什么”；“清淡点的啊”语气口语化，建议改为“清淡一些的菜”。

修正后的完整语句：  
1. 江汉路这边有什么意面店推荐吗？  
2. 意面之家可以哦，正好庆祝升职，嘿嘿！  
3. 海港城这边有什么湘菜馆推荐吗？风大，想就近吃。  
4. 湘鄂情和小湘菜有什么推荐的菜吗？比如有没有饺子、馄饨之类的？同事想试试低盐的。  
5. 湘西大宅门有什么推荐的菜吗？同事想吃低盐的，有没有清淡一些的菜？


现在，请对以下用户话语进行纠错处理：

{{utterances}}
"""
corrector = Template(corrector)

evaluator_prompt = """
现在，用户模拟器正在和对话式推荐系统进行对话。你是一个打分器，你将模拟一个用户，负责对推荐系统的回复进行打分。
注意，你只对推荐系统的最后一轮回复进行打分，而不是对整个对话进行打分。

现在给定用户和推荐系统的对话如下：
{{dialogue}}

用户的画像如下：
{{user_profile}}

你需要对推荐系统的进行3个打分，它们的评分标准如下：
{{language}}
{{recommendation}}
{{action}}

请按照评分标准的要求和顺序，依次输出每个对话的打分。
"""
evaluator_prompt = Template(evaluator_prompt)


            




    



    